# ===========================================
# TikTok Content Reporting Hub - Environment Variables
# ===========================================

# ============================================
# ENVIRONMENT
# ============================================
NODE_ENV=development

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT=3000
HOST=0.0.0.0

# ============================================
# DATABASE CONFIGURATION
# ============================================
DATABASE_URL=postgresql://dev_user:Dev_User123@localhost:5432/tiktok_hubs

# Database Pool Configuration (OPTIMIZED FOR 300+ STORES)
# Adjust based on your PostgreSQL max_connections setting
# Recommended: Set PostgreSQL max_connections = DB_POOL_SIZE + 50 (for other connections)
DB_POOL_SIZE=100          # Maximum connections in pool (default: 100)
DB_POOL_MIN=20            # Minimum idle connections (default: 20)
DB_LOGGING=false          # Enable SQL query logging (true/false)

# Test Database (optional for integration tests)
TEST_DATABASE_URL=postgresql://dev_user:Dev_User123@localhost:5432/tiktok_hubs

# Docker Database Credentials (for docker-compose.yml)
DB_USER=tiktok_user
DB_PASSWORD=your_secure_db_password_here
DB_NAME=tiktok_hubs
DB_HOST=db
DB_PORT=5432

# ============================================
# SYNC PERFORMANCE CONFIGURATION (300+ STORES)
# ============================================
# Parallel sync concurrency - adjust based on:
# 1. Your server CPU/RAM capacity
# 2. TikTok API rate limits
# 3. Database connection pool size

# User sync: 30 concurrent stores (fast - single API call per store)
SYNC_CONCURRENCY=30

# Video sync: 20 concurrent stores (slower - multiple API calls + pagination)
VIDEO_SYNC_CONCURRENCY=20

# Expected performance for 300 stores:
# - User sync: ~2-3 minutes (vs 15-20 min sequential)
# - Video sync: ~5-8 minutes (vs 35-50 min sequential)
# - Total: ~7-11 minutes (vs 50-70 min sequential)

# ============================================
# TIKTOK API CREDENTIALS
# ============================================
# Get these from https://developers.tiktok.com/apps
TIKTOK_CLIENT_KEY=your_tiktok_client_key_here
TIKTOK_CLIENT_SECRET=your_tiktok_client_secret_here

# OAuth Redirect URI (must match TikTok Developer Portal EXACTLY)
TIKTOK_REDIRECT_URI=http://localhost:3000/auth/tiktok/callback

# OAuth State Secret (HMAC signing for CSRF protection)
# Generate with: openssl rand -base64 32
STATE_SECRET=your_oauth_state_secret_here

# ============================================
# ENCRYPTION
# ============================================
# Token encryption key (AES-256-GCM)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
TOKEN_ENC_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# ============================================
# ADMIN API AUTHENTICATION
# ============================================
# API Key for admin endpoints
# Generate with: openssl rand -base64 32
ADMIN_API_KEY=your_secure_admin_api_key_here

# ============================================
# CORS CONFIGURATION
# ============================================
# Allowed origins (comma-separated for multiple)
# In production, MUST specify actual domain(s), not "*"
CORS_ORIGIN=http://localhost:5173,http://localhost:3000

# ============================================
# SCHEDULER CONFIGURATION
# ============================================
# Enable/disable automatic scheduled syncs
CRON_ENABLED=true

# Timezone for cron jobs
TZ=UTC

# Cron schedules (using node-cron format)
# Staggered to avoid peak load:
# 1. Token refresh at 1:00 AM (before syncs)
# 2. User sync at 2:00 AM
# 3. Video sync at 3:00 AM (heavier operation)
CRON_TOKEN_REFRESH=0 1 * * *      # Daily at 1:00 AM
CRON_SYNC_USER_DAILY=0 2 * * *    # Daily at 2:00 AM
CRON_SYNC_VIDEO_DAILY=0 3 * * *   # Daily at 3:00 AM

# ============================================
# LOGGING
# ============================================
LOG_LEVEL=info                     # trace, debug, info, warn, error, fatal

# ============================================
# REDIS (OPTIONAL - For production scale)
# ============================================
# Uncomment these if you deploy multiple backend instances
# Redis provides:
# - Distributed rate limiting (shared across instances)
# - Token caching (reduce encryption overhead)
# - Distributed locking (prevent duplicate syncs)

# REDIS_URL=redis://localhost:6379
# ENABLE_REDIS=false
# ENABLE_TOKEN_CACHE=false
# TOKEN_CACHE_TTL_SEC=300           # Cache decrypted tokens for 5 minutes
